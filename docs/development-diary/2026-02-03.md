# Дневник разработки — 2026-02-03

## Состояние проекта (снимок)

- Стек: Next.js App Router + TypeScript (Next 16.1.6), pnpm, Tailwind.
- Supabase: Postgres + RLS + политики Storage через миграции в `supabase/migrations/`.
- Публичная часть:
  - `/` редиректит на `/models`.
  - `/models`: переключатель CARDS/LIST (URL + fallback через sessionStorage), фильтр по категориям, пагинация + общий count.
  - `/models/[document_id]`: hero + gallery + мета-блоки + CTA в Telegram.
  - Marquee под header: настройки из БД, обновление через polling/focus-refetch, поддерживает `enabled/speed/direction`.
- Админка:
  - `/admin/login`: email/password.
  - Guard + проверка роли (`profiles.role` в `admin/editor`) на сервере.
  - `/admin/models`: create/edit, publish/unpublish, delete.
  - Медиа: загрузка hero + множественная загрузка gallery, reorder (up/down), удаление (также удаляет из Storage).
  - `/admin/settings/marquee`: редактирование `enabled/text_ru/text_en/speed/direction`.
- Изображения: подписанные URL из Supabase Storage с transform (`width/quality`) + `next/image`.

## Выполненные проверки

- Подключение к Supabase (anon): читается `settings_marquee` (id=1); опубликованные assets читаются (возвращается count).
- Ручная проверка через Playwright (локальный dev server):
  - `/` → `/models`: редирект работает.
  - `/models`: страница рендерится, CARDS/LIST работает (меняет URL), фильтр категории присутствует.
  - `/models/[document_id]`: страница рендерится и показывает CTA в Telegram.
  - `/admin` редиректит на `/admin/login`; форма логина рендерится.

## Не сделано / нужно подтвердить (из `docs/dev-plan.md` и `docs/tech-plan.md`)

- Vercel:
  - Создать/подключить проект в Vercel.
  - Подтвердить Preview/Production auto-deploy и env vars в Vercel.
- Первичная настройка Supabase Auth:
  - Подтвердить, что включён Email/Password в Supabase Auth.
  - Создать admin-пользователя и выставить `profiles.role = 'admin'` (триггер по умолчанию ставит `editor`).
- Демо-чеклист ещё не прогнан end-to-end:
  - Создать модель, загрузить hero + gallery, поменять порядок, опубликовать.
  - Подтвердить, что модель появилась в `/models`, и детальная страница корректна для новой модели.
  - Изменить marquee в админке и подтвердить, что на публичной части оно обновляется через polling.
- Smoke-проверки, требующие учётных данных:
  - «Admin login works» (реальный вход) и «CRUD/upload works» не были полностью провалидированы.
